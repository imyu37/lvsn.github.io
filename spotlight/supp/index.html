<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./favicon.ico">

    <title>SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</title>

    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/lightbox.min.css" rel="stylesheet">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Custom styles for this template -->
    <link href="./css/sticky-footer-navbar.css" rel="stylesheet">
    <style>
      /* Center and constrain the table */
      #results-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Center align items horizontally */
        max-width: 100%; /* Constrain overall width */
        margin: 0 auto; /* Center align the container itself */
      }
  
      .result-cell {
        flex: 1 0 220px; /* Flexible size with minimum 220px */
        max-width: 220px; /* Prevent over-expansion */
        margin: 0px; /* Space between cells */
        overflow: hidden;
        border: 1px solid #ddd;
        text-align: center;
        padding: 0;
      }
  
      .img-container {
        position: relative;
        width: 100%;
        height: 220px;
      }
  
      .result-cell img {
        width: 100%;
        height: auto;
        position: absolute;
        top: 0;
        left: 0;
      }
  
      .method-label {
        text-align: center;
        margin-top: 5px;
      }
  
      .row.mb-3 {
        width: 100%;
        justify-content: center; /* Align rows to center */
      }

      figurecaption {
        text-align: center;
        display: block;
      }
    </style>
  </head>
  <body>

    <header>
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="#">Supplementary Material</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-expanded="false" aria-controls="navbarCollapse" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <!-- <a class="navbar-brand" href="#">Sticky footer</a> -->
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="#moving">Moving lighting</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#editing">Editing</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#outdoor_test">Outdoor results</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#indoor_test">Indoor results</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#implementation">Implementation details</span></a>
            </li>
          </ul>
        </div>
      </nav>
    </header>

    <!-- Begin page content -->
    <div class="container">
      <div class="mt-1">
        <h1>SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</h1>
      </div>
      <p align="justify" class="lead">
        TODO
      </p>

      <div style="clear:both; height:2em;"></div>
      <h3>Table of Contents</h3>
      <p>
      <ol>
        <li>
          <a href="#qual_results_control">Additional qualitative results (extends fig. 5)</a>
        </li>
        <li>
          <a href="#light_control_video">Light control video</a>
        </li>
        <li>
          <a href="#demo">Demo</a>
        </li>
        <li>
          <a href="#multiple_lights">Multiple lights</a>
        </li>  
        <li>
          <a href="#background_relighting">Background relighting</span></a>
        </li>        
      </ol>
      </p>

      <a class="anchor" name="qual_results_control"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>1. Additional qualitative results</h2>
      <p align="justify">We present additional randomly-selected results on the "user-controlled" dataset, extending the qualitative results from f ig.5.
        In this case, we rendered 8 light directions instead
        of 5 (as used for the user study), in order to show light directions where the shadow is behind the object.
        Move your mouse from left to right over the images to see the light direction change.
      </p>

      <div id="results-container-fig-5-ext" class="row"></div>


      <a class="anchor" name="light_control_video"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>2. Additional results on classifier-free guidance weight</h2>
      <p align="justify">Here, we show control over the classifier-free guidance scale, extending fig. 6. By hovering over the images and moving the mouse vertically, the guidance scale is adjusted:
        from γ=1.0 (cursor at the top of an image) to γ=7.0 (cursor at the bottom of an image).
      </p>
       
      <p>Light azimuth angle <input type="range" min="0" max="7" value="0" class="slider" id="cfg-azimuth-slider"></p>
      <p align="justify">The current guidance scale is <strong id="gamma-scale">γ=3.0</strong>. <input type="range" min="0" max="2" value="1" class="slider" id="cfg-gamma-slider"></p>
      <div id="results-container-cfg" class="row"></div>

      <a class="anchor" name="light_control_video"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>2. Light elevation and size</h2>
      <div id="results-container-light-size" class="row"></div>

      <a class="anchor" name="demo"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>3. 2D object compositing control example</h2>

      <p>TODO.</p>
      <div id="results-container-compositing-2d" class="row"></div>

      
      
      <a class="anchor" name="multiple_lights"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>4. Multiple lights</h2>

      <p>TODO - 2 examples.</p>

      
    <a class="anchor" name="implementation"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>5. Background relighting</h2>
      <p>TODO - 1 example.</p>

      <a class="anchor" name="user_study"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>6. User study</h2>
    <div class="row">
      <div class="col-md-12">
        <a href="figures/user_study/instructions.png" target="_blank">
          <img src="figures/user_study/instructions.png" class="border border-secondary" alt="User study instructions" style="width: 100%;">
        </a>
        <figurecaption>User study intructions page</figurecaption>
      </div>
    </div>
    <br>
    <br>
    <div class="row">
      <div class="col-md-12">
        <a href="figures/user_study/question.png" target="_blank">
          <img src="figures/user_study/question.png" class="border border-secondary" alt="User study question" style="width: 100%;">
        </a>
        <figurecaption>User study question page</figurecaption>
      </div>
    </div>


    <footer class="footer navbar-fixed-bottom" style="left: 0">
      <div class="container">
        <span class="text-muted">SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</span>
      </div>
    </footer>

  <script>
    const nameMapping = {
      'shadow_comp_v2_default_post_color_balanced_denoised': "Ours (ZeroComp)",
      'rgbx_cfg_3_intensity_2_inpaint_post_color_balanced_denoised': 'Ours (RGB-X)',
      'ic_light_bg_guidance_denoised': 'IC Light [73]',
      'dilightnet_denoised': 'DiLightNet [71]',
      'neural_gaffer_denoised': 'Neural Gaffer [30]',
      'stick-renders': 'Light direction',
      'simulated_gt': 'Simulated GT',
    }
    const defaultLightDirections = ['0000', '0001', '0002', '0003', '0004', '0005', '0006', '0007'];

    const makeResultsTable = (resultsContainer, methods, cropNames, folderName, lightDirections=defaultLightDirections) => {
      cropNames.forEach(crop => {
        const row = document.createElement('div');
        row.classList.add('row', 'mb-3');

        row.dataset.crop = crop;

        methods.forEach(method => {
          const col = document.createElement('div');
          col.classList.add('col-md', 'result-cell');
          col.dataset.method = method;
          col.dataset.crop = crop;

          // Create imgContainer
          const imgContainer = document.createElement('div');
          imgContainer.classList.add('img-container');

          // Preload images
          lightDirections.forEach(dir => {
            const img = document.createElement('img');
            img.src = `${folderName}/${method}/${crop}_${dir}.jpg`;
            img.dataset.dir = dir;
            img.style.opacity = dir === '0000' ? 1 : 0; // Show the first light direction
            imgContainer.appendChild(img);
          });

          // Append imgContainer to col
          col.appendChild(imgContainer);

          // Create label
          const label = document.createElement('div');
          label.classList.add('method-label');
          label.innerText = nameMapping[method] || method;

          // Append label to col
          col.appendChild(label);

          row.appendChild(col);
          
        // Add mousemove listener to the entire row
        col.addEventListener('mousemove', e => {
          const rect = col.getBoundingClientRect();
          const relX = e.clientX - rect.left; // Relative X position within the row
          const index = Math.floor(Math.max((relX / rect.width) * lightDirections.length, 0));
          const selectedDir = lightDirections[Math.min(index, lightDirections.length - 1)];

          resultsContainer.querySelectorAll('.result-cell').forEach(cell => {
            cell.querySelectorAll('img').forEach(img => {
              img.style.opacity = img.dataset.dir === selectedDir ? 1 : 0;
            });
          });
        });

        });

        resultsContainer.appendChild(row);
      });
    }
    
    const makeResultsTable2 = (resultsContainer, methods, cropNames, methodsCfgExtMapping, folderName, lightDirections=defaultLightDirections, cropSubfolder=false) => {
      const row = document.createElement('div');
      cropNames.forEach(crop => {
        row.classList.add('row', 'mb-3');

        row.dataset.crop = crop;

        const col = document.createElement('div');
        col.classList.add('col-md', 'result-cell');

        // Create imgContainer
        const imgContainer = document.createElement('div');
        imgContainer.classList.add('img-container');

        methods.forEach(method => {
          // Preload images
          lightDirections.forEach(dir => {
            const img = document.createElement('img');
            if (cropSubfolder) {
              img.src = `${folderName}/${method}/${crop}/${dir}.jpg`;
            } else {
              img.src = `${folderName}/${method}/${crop}_${dir}.jpg`;
            }
            // img.src = `${folderName}/${method}/${crop}_${dir}.jpg`;
            img.dataset.dir = dir;
            img.dataset.method = method;
            img.style.opacity = ((dir === '0000') && (method === 'shadow_comp_v2_default_post_color_balanced_denoised')) ? 1 : 0; // Show the first light direction
            img.style.opacity = 0;
            imgContainer.appendChild(img);
          });
        });
        // Append imgContainer to col
        col.appendChild(imgContainer);

        // Create label
       // const label = document.createElement('div');
       // label.classList.add('method-label');
       // label.innerText = nameMapping[method] || method;

        // // Append label to col
        // col.appendChild(label);

        row.appendChild(col);

        // Add mousemove listener to the entire row
        col.addEventListener('mousemove', e => {
          const rect = row.getBoundingClientRect();
          const relX = e.clientX - rect.left; // Relative X position within the row
          const indexDir = Math.floor(Math.max((relX / rect.width) * lightDirections.length, 0));
          const selectedDir = lightDirections[Math.min(indexDir, lightDirections.length - 1)];

          const relY = e.clientY - rect.top; // Relative Y position within the row
          const indexCfg = Math.floor(Math.max((relY / rect.height) * methods.length, 0));
          const selectedCfg = methods[Math.min(indexCfg, methods.length - 1)];
          console.log(selectedCfg);
          console.log(methodsCfgExtMapping[selectedCfg]);


          resultsContainer.querySelectorAll('.result-cell').forEach(cell => {
            cell.querySelectorAll('img').forEach(img => {
              img.style.opacity = ((img.dataset.dir === selectedDir) && (img.dataset.method === selectedCfg)) ? 1 : 0;
            });
          });
          document.getElementById('gamma-scale').innerText = `${methodsCfgExtMapping[selectedCfg]}`;
        });

      });
      resultsContainer.appendChild(row);
    }
    
    const cropNamesFig5ext = ["9C4A8088-1bb62eeb83_07_crop_B07B4MRLNC", "AG8A6719-fc8e1ea686_05_crop_B072Y5MZQH", "9C4A0400-e71f3506f8_00_crop_B07QC8CGKK", "9C4A0395-ef28332472_09_crop_B07YPLQ7KW", "AG8A1932-eb0d101d0e_07_crop_B00BBDF500", "9C4A3419-2e5c9b4d85_00_crop_B07B4MG2MD", "9C4A4668-16193e7517_03_crop_B072FVHS4V", "AG8A4106-248c9b6695_01_crop_B07G2WWZC5", "9C4A6765-55315335bf_09_crop_B076YFLYFR", "9C4A0400-e71f3506f8_00_crop_B07B4CZMNQ", "9C4A0566-a088c98ccf_00_crop_B07HZ6ZCW7", "9C4A0132-07352d1dd0_08_crop_B07PHP31FB", "9C4A9487-24b5ce36e4_01_crop_B07B4MDGDF", "AG8A4106-248c9b6695_00_crop_B07HZ1LZS1", "AG8A8563-e652dd5751_02_crop_B07QHYDDS1", "9C4A0132-07352d1dd0_07_crop_B07DBF3WMC", "9C4A6864-533a74ab58_04_crop_B076VF4KRN", "9C4A5673-d4ecde512a_00_crop_B07HPTBB7P", "AG8A8710-4a14a72a31_05_crop_B07B4LZQC9", "9C4A0400-e71f3506f8_00_crop_B082QBBY7R"]; // Example crop names
    const methodsFig5ext = [
      'ic_light_bg_guidance_denoised',
      'dilightnet_denoised',
      'neural_gaffer_denoised',
      'rgbx_cfg_3_intensity_2_inpaint_post_color_balanced_denoised', 
      'shadow_comp_v2_default_post_color_balanced_denoised'
    ]
    const resultsContainerFig5ext = document.getElementById('results-container-fig-5-ext');

    makeResultsTable(resultsContainerFig5ext, methodsFig5ext, cropNamesFig5ext, folderName='figures/qual_many_directions_html');


    const cropNamesCfgExt = ["9C4A0395-ef28332472_02_crop_B07HSKBHBT", "AG8A3196-8e1dfd8d95_04_crop_B07QC6X16K", "AG8A9732-581cf3704d_00_crop_B0831Q5ZW3", "9C4A0307-ca23f47d11_05_crop_B07MJL5BDH", "9C4A0566-a088c98ccf_05_crop_B085FHBF21", "9C4A4878-4dac321d8b_02_crop_B07HP93VDJ", "AG8A6719-fc8e1ea686_05_crop_B07DBJ1H18", "9C4A0132-07352d1dd0_01_crop_B085GXH67Y", "AG8A1285-e7ec2299e7_08_crop_B07263589M", "AG8A9732-581cf3704d_02_crop_B07HPNGPCS", "9C4A6765-55315335bf_09_crop_B0728KSP2R", "AG8A9732-581cf3704d_06_crop_B07B874GDK", "AG8A7380-2cbab4672a_05_crop_B07VP8ZD91", "AG8A3602-95e21caa53_08_crop_B07BWK44K2", "9C4A3359-3edd9ddf7d_08_crop_B07B4MH9DB", "AG8A9732-581cf3704d_01_crop_B07B4L56TX", "AG8A9732-581cf3704d_09_crop_B07BWJMB8Q", "AG8A6551-16ae8050c9_05_crop_B07H8T5XNK", "9C4A3419-2e5c9b4d85_08_crop_B07B4D8B2S", "AG8A4106-248c9b6695_02_crop_B07S95M22D"]
    const methodsCfgExt = [
        'shadow_comp_v2_cfg_1_post_color_balanced_denoised',
        'shadow_comp_v2_default_post_color_balanced_denoised',
        'shadow_comp_v2_cfg_7_post_color_balanced_denoised',
    ]
    const methodsCfgExtMapping = {
        'shadow_comp_v2_cfg_1_post_color_balanced_denoised': 'γ=1.0 (no guidance)',
        'shadow_comp_v2_default_post_color_balanced_denoised': 'γ=3.0',
        'shadow_comp_v2_cfg_7_post_color_balanced_denoised': 'γ=7.0',
    }
    const resultsContainerCfgExt = document.getElementById('results-container-cfg');
    makeResultsTable2(resultsContainerCfgExt, methodsCfgExt, cropNamesCfgExt, methodsCfgExtMapping, folderName='figures/ext_cfg');

    const cropNamesLightSize = ["9C4A0132-07352d1dd0_08_crop_B07PHP31FB", "9C4A5046-e0854552ca_08_crop_B07B4G5RBN", "9C4A5858-0338b2aed1_09_crop_B072635FKH", "9C4A0566-a088c98ccf_00_crop_B07J2R9Y4W", "AG8A7849-375e867fcd_01_crop_B07B4GSKS1", "9C4A0566-a088c98ccf_04_crop_B075X12QV9", "9C4A0132-07352d1dd0_01_crop_B07JVNBJTB", "9C4A8239-7a9d7093e2_04_crop_B0728NWFCG", "AG8A9732-581cf3704d_09_crop_B07BWJMB8Q", "AG8A8626-28011c026e_02_crop_B07B7DFS3S", "9C4A6817-e170a870c0_02_crop_B07B4FZHH6", "AG8A9732-581cf3704d_07_crop_B07TZRLNFV", "9C4A3235-5e5a966c6a_06_crop_B075YQXRBS", "9C4A8928-2fbd3aa74a_02_crop_B07JBB5PHH", "9C4A1891-85da239af9_05_crop_B07DBF3TWR", "AG8A3602-95e21caa53_03_crop_B07DBKNWZT", "AG8A9732-581cf3704d_02_crop_B07HSMVFMP", "AG8A4106-248c9b6695_00_crop_B07HZ1LZS1", "AG8A9732-581cf3704d_02_crop_B07HPNGPCS", "9C4A0132-07352d1dd0_02_crop_B082QD61D9"]
    const methodsLightSize = [
        'shadow_comp_v2_light_radius_0_post_color_balanced_denoised',
        'shadow_comp_v2_default_post_color_balanced_denoised',
        'shadow_comp_v2_light_radius_5_post_color_balanced_denoised',
    ]
    const methodsLightSizeMapping = {
        'shadow_comp_v2_light_radius_0_post_color_balanced_denoised': 'Light radius 0',
        'shadow_comp_v2_default_post_color_balanced_denoised': 'Light radius 1',
        'shadow_comp_v2_light_radius_5_post_color_balanced_denoised': 'Light radius 5',
    }
    const resultsContainerLightSize = document.getElementById('results-container-light-size');
    makeResultsTable2(resultsContainerLightSize, methodsLightSize, cropNamesLightSize, methodsLightSizeMapping, folderName='figures/light_size');

    const cropNamesCompositing2d = ['bg-3_obj-5', 'bg-9_obj-1', 'bg-10_obj-11']
    const methodsCompositing2d = [
        'shadow_comp_v2_default_neg_no_shadow_details_transfered_post_color_balanced',
    ]
    const methodsCompositing2dMapping = {
        'shadow_comp_v2_default_neg_no_shadow_details_transfered_post_color_balanced': 'Ours',
    }
    const resultsContainerCompositing2d = document.getElementById('results-container-compositing-2d');
    const lightDirectionsCompositing2d = [
      'x-511_y-300_horizon-100_softness-0.1',
      //'x-511_y-100_horizon-300_softness-0.1',
      'x-511_y-100_horizon-100_softness-0.1',
      'x-384_y-100_horizon-100_softness-0.1',
     // 'x-256_y-300_horizon-100_softness-0.1',
      'x-128_y-100_horizon-100_softness-0.1',
      'x-128_y-300_horizon-100_softness-0.1',
      'x-0_y-300_horizon-100_softness-0.1'
    ];
    makeResultsTable2(resultsContainerCompositing2d, methodsCompositing2d, cropNamesCompositing2d, methodsCompositing2dMapping, folderName='figures/compositing_2d', lightDirections=lightDirectionsCompositing2d, cropSubfolder=true);
  </script>
    <script src="./js/lightbox-plus-jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
  </body>
</html>
