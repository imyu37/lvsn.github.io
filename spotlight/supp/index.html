<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./favicon.ico">

    <title>SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</title>

    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/lightbox.min.css" rel="stylesheet">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Custom styles for this template -->
    <link href="./css/sticky-footer-navbar.css" rel="stylesheet">
    <style>
      /* Center and constrain the table */
      #results-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Center align items horizontally */
        max-width: 100%; /* Constrain overall width */
        margin: 0 auto; /* Center align the container itself */
      }
  
      .result-cell {
        flex: 1 0 180px; /* Flexible size with minimum 180px */
        max-width: 180px; /* Prevent over-expansion */
        margin: 0px; /* Space between cells */
        overflow: hidden;
        border: 1px solid #ddd;
        text-align: center;
        padding: 0;
      }
  
      .img-container {
        position: relative;
        width: 100%;
        height: 180px;
      }
  
      .result-cell img {
        width: 100%;
        height: auto;
        position: absolute;
        top: 0;
        left: 0;
      }
  
      .method-label {
        text-align: center;
        margin-top: 5px;
      }
  
      .row.mb-3 {
        width: 100%;
        justify-content: center; /* Align rows to center */
      }

      figurecaption {
        text-align: center;
        display: block;
      }
    </style>
  </head>
  <body>

    <header>
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="#">Supplementary Material</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-expanded="false" aria-controls="navbarCollapse" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <!-- <a class="navbar-brand" href="#">Sticky footer</a> -->
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="#moving">Moving lighting</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#editing">Editing</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#outdoor_test">Outdoor results</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#indoor_test">Indoor results</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#implementation">Implementation details</span></a>
            </li>
          </ul>
        </div>
      </nav>
    </header>

    <!-- Begin page content -->
    <div class="container">
      <div class="mt-1">
        <h1>SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</h1>
      </div>
      <p align="justify" class="lead">
        TODO
      </p>

      <div style="clear:both; height:2em;"></div>
      <h3>Table of Contents</h3>
      <p>
      <ol>
        <li>
          <a href="#qual_results_control">Additional qualitative results (extends fig. 5)</a>
        </li>
        <li>
          <a href="#light_control_video">Light control video</a>
        </li>
        <li>
          <a href="#demo">Demo</a>
        </li>
        <li>
          <a href="#multiple_lights">Multiple lights</a>
        </li>  
        <li>
          <a href="#background_relighting">Background relighting</span></a>
        </li>
        <li>
          <a href="#implementation">Implementation Details</span></a>
        </li>
        
      </ol>
      </p>

      <a class="anchor" name="qual_results_control"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>1. Additional qualitative results</h2>
      <p align="justify">We present additional randomly-selected results on the "user-controlled" dataset. In this case, we rendered 8 light directions instead
        of 5 (as used for the user study), in order to show light directions where the shadow is behind the object.
        Move your mouse from left to right over the images to see the light direction change.
      </p>

      <div id="results-container" class="row"></div>


      <a class="anchor" name="light_control_video"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>2. Additional results on classifier-free guidance weight</h2>
      <p align="justify">TODO.</p>

      <a class="anchor" name="light_control_video"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>2. Light elevation and size</h2>

      <a class="anchor" name="demo"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>3. 2D object compositing control example</h2>

      <p>TODO.</p>
      
      
      <a class="anchor" name="multiple_lights"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>4. Multiple lights</h2>

      <p>TODO - 2 examples.</p>

      
    <a class="anchor" name="implementation"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>5. Background relighting</h2>
      <p>TODO - 1 example.</p>

      <a class="anchor" name="user_study"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>6. User study</h2>
    <div class="row">
      <div class="col-md-12">
        <a href="figures/user_study/instructions.png" target="_blank">
          <img src="figures/user_study/instructions.png" class="border border-secondary" alt="User study instructions" style="width: 100%;">
        </a>
        <figurecaption>User study intructions page</figurecaption>
      </div>
    </div>
    <br>
    <br>
    <div class="row">
      <div class="col-md-12">
        <a href="figures/user_study/question.png" target="_blank">
          <img src="figures/user_study/question.png" class="border border-secondary" alt="User study question" style="width: 100%;">
        </a>
        <figurecaption>User study question page</figurecaption>
      </div>
    </div>


    <footer class="footer navbar-fixed-bottom" style="left: 0">
      <div class="container">
        <span class="text-muted">SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</span>
      </div>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
  <script>
    const cropNames = ["9C4A8088-1bb62eeb83_07_crop_B07B4MRLNC", "AG8A6719-fc8e1ea686_05_crop_B072Y5MZQH", "9C4A0400-e71f3506f8_00_crop_B07QC8CGKK", "9C4A0395-ef28332472_09_crop_B07YPLQ7KW", "AG8A1932-eb0d101d0e_07_crop_B00BBDF500", "9C4A3419-2e5c9b4d85_00_crop_B07B4MG2MD", "9C4A4668-16193e7517_03_crop_B072FVHS4V", "AG8A4106-248c9b6695_01_crop_B07G2WWZC5", "9C4A6765-55315335bf_09_crop_B076YFLYFR", "9C4A0400-e71f3506f8_00_crop_B07B4CZMNQ", "9C4A0566-a088c98ccf_00_crop_B07HZ6ZCW7", "9C4A0132-07352d1dd0_08_crop_B07PHP31FB", "9C4A9487-24b5ce36e4_01_crop_B07B4MDGDF", "AG8A4106-248c9b6695_00_crop_B07HZ1LZS1", "AG8A8563-e652dd5751_02_crop_B07QHYDDS1", "9C4A0132-07352d1dd0_07_crop_B07DBF3WMC", "9C4A6864-533a74ab58_04_crop_B076VF4KRN", "9C4A5673-d4ecde512a_00_crop_B07HPTBB7P", "AG8A8710-4a14a72a31_05_crop_B07B4LZQC9", "9C4A0400-e71f3506f8_00_crop_B082QBBY7R"]; // Example crop names
    const methods = [
        'stick-renders', 
        'ic_light_bg_guidance_denoised', 
        'dilightnet_denoised', 
        'neural_gaffer_denoised', 
        'rgbx_cfg_3_intensity_2_inpaint_post_color_balanced_denoised', 
        'shadow_comp_v2_default_post_color_balanced_denoised'
    ]
    const nameMapping = {
      'shadow_comp_v2_default_post_color_balanced_denoised': "Ours (ZeroComp)",
      'rgbx_cfg_3_intensity_2_inpaint_post_color_balanced_denoised': 'Ours (RGB-X)',
      'ic_light_bg_guidance_denoised': 'IC Light [73]',
      'dilightnet_denoised': 'DiLightNet [71]',
      'neural_gaffer_denoised': 'Neural Gaffer [30]',
      'stick-renders': 'Light direction',
      'simulated_gt': 'Simulated GT',
  }

    const lightDirections = ['0000', '0001', '0002', '0003', '0004', '0005', '0006', '0007'];

    const resultsContainer = document.getElementById('results-container');
    cropNames.forEach(crop => {
        const row = document.createElement('div');
        row.classList.add('row', 'mb-3');

        row.dataset.crop = crop;

        methods.forEach(method => {
          const col = document.createElement('div');
          col.classList.add('col-md', 'result-cell');
          col.dataset.method = method;
          col.dataset.crop = crop;

          // Create imgContainer
          const imgContainer = document.createElement('div');
          imgContainer.classList.add('img-container');

          // Preload images
          lightDirections.forEach(dir => {
            const img = document.createElement('img');
            img.src = `figures/qual_many_directions_html/${method}/${crop}_${dir}.jpg`;
            img.dataset.dir = dir;
            img.style.opacity = dir === '0000' ? 1 : 0; // Show the first light direction
            imgContainer.appendChild(img);
          });

          // Append imgContainer to col
          col.appendChild(imgContainer);

          // Create label
          const label = document.createElement('div');
          label.classList.add('method-label');
          label.innerText = nameMapping[method] || method;

          // Append label to col
          col.appendChild(label);

          row.appendChild(col);
        });

        // Add mousemove listener to the entire row
        row.addEventListener('mousemove', e => {
          const rect = row.getBoundingClientRect();
          const relX = e.clientX - rect.left; // Relative X position within the row
          const index = Math.floor(Math.max((relX / rect.width) * lightDirections.length, 0));
          const selectedDir = lightDirections[Math.min(index, lightDirections.length - 1)];

          resultsContainer.querySelectorAll('.result-cell').forEach(cell => {
            cell.querySelectorAll('img').forEach(img => {
              img.style.opacity = img.dataset.dir === selectedDir ? 1 : 0;
            });
          });
        });

        resultsContainer.appendChild(row);
      });
  </script>
    <script src="./js/lightbox-plus-jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
  </body>
</html>
