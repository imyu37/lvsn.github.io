<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="./favicon.ico">

    <title>SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</title>

    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/lightbox.min.css" rel="stylesheet">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Custom styles for this template -->
    <link href="./css/sticky-footer-navbar.css" rel="stylesheet">
    <style>
      /* Center and constrain the table */
      #results-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Center align items horizontally */
        max-width: 100%; /* Constrain overall width */
        margin: 0 auto; /* Center align the container itself */
      }
  
      .result-cell {
        flex: 1 0 220px; /* Flexible size with minimum 220px */
        max-width: 220px; /* Prevent over-expansion */
        margin: 0px; /* Space between cells */
        overflow: hidden;
        border: 1px solid #ddd;
        text-align: center;
        padding: 0;
      }
  
      .img-container {
        position: relative;
        width: 100%;
        height: 220px;
      }
  
      .result-cell img {
        width: 100%;
        height: auto;
        position: absolute;
        top: 0;
        left: 0;
      }
  
      .method-label {
        text-align: center;
        margin-top: 5px;
      }
  
      .row.mb-3 {
        width: 100%;
        justify-content: center; /* Align rows to center */
      }

      figurecaption {
        text-align: center;
        display: block;
      }
    </style>
  </head>
  <body>

    <header>
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="#">Supplementary Material</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-expanded="false" aria-controls="navbarCollapse" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <!-- <a class="navbar-brand" href="#">Sticky footer</a> -->
          <ul class="navbar-nav mr-auto">
            <li class="nav-item">
              <a class="nav-link" href="#qual_results_control">Qualitative results</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#parameter_control">Parameter control</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#virtual_light_source">Virtual light source</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#multiple_lights">Multiple lights</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#bg_relight">Background relighting</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#user_study">User study interface</a>
            </li>
          </ul>
        </div>
      </nav>
    </header>

    <!-- Begin page content -->
    <div class="container">
      <div class="mt-1">
        <h1>SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</h1>
      </div>
      <p align="justify" class="lead">
        We present additional results complementing the main paper. You will be able to experience the control our method provides by 
        <span class="font-weight-bold">hovering over the images or using
        sliders</span>.
      </p>

      <div style="clear:both; height:2em;"></div>
      <h3>Table of Contents</h3>
      <p>
      <ol>
        <li>
          <a href="#qual_results_control">Additional qualitative results (extends fig. 5)</a>
        </li>
        <li>
          <a href="#parameter_control">Parameter control (extends sec. 4.6)</a>
        </li>
        <li>
          <a href="#virtual_light_source">Virtual light source adjustments</a>
        </li>
        <li>
          <a href="#multiple_lights">Multiple lights</a>
        </li>     
        <li>
          <a href="#bg_relight">Background relighting</a>
        </li>        
        <li>
          <a href="#user_study">User study interface (extends sec. 4.5)</a>
        </li>
      </ol>
      </p>

      <a class="anchor" name="qual_results_control"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>1. Additional qualitative results</h2>
      <p align="justify">We present 20 additional randomly-selected results on the "user-controlled" dataset, extending the qualitative results from fig. 5.
        In this case, we rendered 8 light directions instead
        of 5 (as used for the user study), in order to also show results where the shadow is behind the object.
        Please move your mouse from left to right over the images to see the light direction change.
      </p>

      <div id="results-container-fig-5-ext" class="row"></div>


      <a class="anchor" name="parameter_control"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>2. Additional results for parameter control</h2>
      <p align="justify">
        We show how the two main parameters of our method can be adjusted for artistic control, extending sec. 4.6.
        Here, we show the adjustment of both parameters separately, but they could easily be adjusted simultaneously for optimal results.
      </p>
      <h3>2.1. Guidance scale γ</h3>
      <p align="justify">Here, we show control over the guidance scale γ, extending fig. 6. By using the sliders, the light direction and the guidance scale can be adjusted.
        Increasing the guidance scale generally makes the dominant light source stronger.
      </p>
      <p>The current light azimuth angle is <input type="range" min="0" max="7" value="0" class="slider" id="cfg-azimuth-slider" draggable/> <strong id="cfg-azimuth-value">0°</strong>.</p>
      <p align="justify">The current guidance scale is <input type="range" min="0" max="2" value="1" class="slider" id="cfg-gamma-slider" draggable/> <strong id="cfg-gamma-value">γ=3.0</strong>.</p>
      <div id="results-container-cfg" class="row"></div>

      <h3>2.2. Latent mask weight β</h3>
      <p align="justify">Here, we show control over the latent mask weight β, extending fig. 7. 
        Increasing the latent mask weight makes the dominant shadow darker.        
      </p>
      <p>The current light azimuth angle is <input type="range" min="0" max="7" value="0" class="slider" id="latent-weight-azimuth-slider" draggable/> <strong id="latent-weight-azimuth-value">0°</strong>.</p>
      <p align="justify">The current latent weight is <input type="range" min="0" max="2" value="1" class="slider" id="latent-weight-slider" draggable/> <strong id="latent-weight-value">β=0.05</strong>.</p>
      <div id="results-container-latent-weight" class="row"></div>
       

      <a class="anchor" name="virtual_light_source"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>3. Virtual light source adjustments</h2>
      <p align="justify">Here, we demonstrate the impact of adjusting two parameters of the spherical light source that generated the shadow: its elevation and its radius.
</p>
      <h3>3.1 Light source radius</h3>
      <p align="justify">We adjust the light source radius. Small radius leads to hard shadows, whereas higher radiuses generate more diffuse shadows.

      </p>
      <p>The current light azimuth angle is <input type="range" min="0" max="7" value="0" class="slider" id="light-size-azimuth-slider" draggable/> <strong id="light-size-azimuth-value">0°</strong>.</p>
      <p align="justify">The current light radius is <input type="range" min="0" max="2" value="1" class="slider" id="light-size-slider" draggable/> <strong id="light-size-value">γ=3.0</strong> (at a distance of 10 from the object).</p>
      <div id="results-container-light-size" class="row"></div>

      <h3>3.2 Light source elevation</h3>
      <strong>TODO</strong>
      
      <a class="anchor" name="multiple_lights"></a>
      <div style="clear:both; height:4em;"></div>
      <h2>4. Multiple lights</h2>

      <p>In our paper, we analyze all the methods using a single dominant light source, which is sufficiently realistic in most cases.
        Here, we show that we can linearly combine outputs from SpotLight at different light directions to simulate multiple light sources.
        We combine a static light direction (shadow to the right of the object), with a dynamic direction (hover over the images to move this virtual light). We combine the two lightings
        in linear space (by using the gamma of 2.2) using the following equation:
        $$x_{\text{combined}}=(0.5 \times {x_{\text{light 1}}}^{2.2} + 0.5 \times {x_{\text{light 2}}}^{2.2})^{\frac{1}{2.2}}.$$ 
        Notice how the static shadow and shading has an effect on the combined output. <br><br>
      <div id="results-container-two-lights" class="row"></div>

      
    <a class="anchor" name="bg_relight"></a>
    <div style="clear:both; height:4em;"></div>
    <h2>5. Background relighting</h2>
    <p align="justify">In our work, we use SpotLight for object relighting. We experiment with extending SpotLight for full-scene relighting using the following approach.
      <ol>
        <li>We run SpotLight as-is to render the object lit with a desired shadow. We obtain the <strong>SpotLight</strong> output.</li>
        <li>We run the backbone (in this case ZeroComp), with the inverted shading mask, feeding it only the shading of the object and its shadow 
          (obtained by dividing the SpotLight prediction with the albedo map)
          and letting the backbone shade the background. 
          We obtain the <strong>relit background</strong> output.</li>
        <li>We repeat step 2 for each of the 8 light directions, and average them, giving us the <strong>average relit background</strong>.</li>
        <li>We find that the background relighting in step 2 and 3 poorly reconstruct the background's identity. We therefore obtain a per-pixel highlight map, by dividing 
          the relit background prediction with the average relit background. We multiply that highlight map with the original background and obtain a more accurate output, <strong>relit background + composition</strong>. 
        </li>
      </ol>
      We observe in the following example that background shadows and highlights are added in a consistent manner with respect to the object's shadow.
    </p>
  
    <div id="results-container-bg-relight" class="row"></div>
  <h6>Note about the checkpoint used for background relighting</h6>
    <p align="justify">
      In step 1, we use the same ZeroComp checkpoint as in all other experiments. For steps 2 and 3, in order to properly relight the background, we found that this checkpoint
      had limited full-scene relighting capabilities.
      We hypothesize that this is due to the fact that the neural renderer backbone is trained to relight only a small region of an image (circular and rectangular masks at training time).
      We therefore train a separate model from scratch for 270K iterations on inverted shading masks, where we take the inverse of the circular and rectangular masks for shading masking. Furthermore,
      we only keep the largest connected component in the mask. This leaves training examples where only a small region of the shading is known and the full background lighting needs to be inferred.
</p>

    <a class="anchor" name="user_study"></a>
    <div style="clear:both; height:4em;"></div>
    <h2>6. User study interface</h2>
    <p>Here, we show the user interface used to perform our human perceptual study, as described in sec. 4.5 in the paper. The user is first shown an instructions page, followed by the questions page (which is the same for the 120 2AFC questions).</p>
    <div class="row">
      <div class="col-md-12">
        <a href="figures/user_study/instructions.png" target="_blank">
          <img src="figures/user_study/instructions.png" class="border border-secondary" alt="User study instructions" style="width: 100%;">
        </a>
        <figurecaption>User study intructions page</figurecaption>
      </div>
    </div>
    <br>
    <br>
    <div class="row">
      <div class="col-md-12">
        <a href="figures/user_study/question.png" target="_blank">
          <img src="figures/user_study/question.png" class="border border-secondary" alt="User study question" style="width: 100%;">
        </a>
        <figurecaption>User study question page</figurecaption>
      </div>
    </div>
    <br>
    <br>


    <footer class="footer navbar-fixed-bottom" style="left: 0">
      <div class="container">
        <span class="text-muted">SpotLight: Shadow-Guided Object Relighting via Diffusion &mdash; Supplementary Material</span>
      </div>
    </footer>
  <script src="./js/custom/additional_qual.js"></script>
  <script src="./js/custom/custom_exp.js"></script>
  <script>
    
    makeResultsTable({
        resultsContainer: document.getElementById('results-container-fig-5-ext'),
        methods: [
        'ic_light_bg_guidance_denoised',
        'dilightnet_denoised',
        'neural_gaffer_denoised',
        'rgbx_cfg_3_intensity_2_inpaint_post_color_balanced_denoised', 
        'shadow_comp_v2_default_post_color_balanced_denoised'
        ],
        cropNames: ["9C4A8088-1bb62eeb83_07_crop_B07B4MRLNC", "AG8A6719-fc8e1ea686_05_crop_B072Y5MZQH", "9C4A0400-e71f3506f8_00_crop_B07QC8CGKK", "9C4A0395-ef28332472_09_crop_B07YPLQ7KW", "AG8A1932-eb0d101d0e_07_crop_B00BBDF500", "9C4A3419-2e5c9b4d85_00_crop_B07B4MG2MD", "9C4A4668-16193e7517_03_crop_B072FVHS4V", "AG8A4106-248c9b6695_01_crop_B07G2WWZC5", "9C4A6765-55315335bf_09_crop_B076YFLYFR", "9C4A0400-e71f3506f8_00_crop_B07B4CZMNQ", "9C4A0566-a088c98ccf_00_crop_B07HZ6ZCW7", "9C4A0132-07352d1dd0_08_crop_B07PHP31FB", "9C4A9487-24b5ce36e4_01_crop_B07B4MDGDF", "AG8A4106-248c9b6695_00_crop_B07HZ1LZS1", "AG8A8563-e652dd5751_02_crop_B07QHYDDS1", "9C4A0132-07352d1dd0_07_crop_B07DBF3WMC", "9C4A6864-533a74ab58_04_crop_B076VF4KRN", "9C4A5673-d4ecde512a_00_crop_B07HPTBB7P", "AG8A8710-4a14a72a31_05_crop_B07B4LZQC9", "9C4A0400-e71f3506f8_00_crop_B082QBBY7R"],
        methodsMapping: {
        'shadow_comp_v2_default_post_color_balanced_denoised': "Ours (ZeroComp)",
        'rgbx_cfg_3_intensity_2_inpaint_post_color_balanced_denoised': 'Ours (RGB-X)',
        'ic_light_bg_guidance_denoised': 'IC Light [73]',
        'dilightnet_denoised': 'DiLightNet [71]',
        'neural_gaffer_denoised': 'Neural Gaffer [30]',
        'stick-renders': 'Light direction',
        'simulated_gt': 'Simulated GT',
        },
        folderName: 'figures/ext_fig_5',
    });

    makeResultsTable2({
        resultsContainer: document.getElementById('results-container-cfg'),
        azimuthSlider: document.getElementById('cfg-azimuth-slider'),
        azimuthValueText: document.getElementById('cfg-azimuth-value'),
        parameterSlider: document.getElementById('cfg-gamma-slider'),
        parameterValueText: document.getElementById('cfg-gamma-value'),
        methods: [
        'shadow_comp_v2_cfg_1_post_color_balanced_denoised',
        'shadow_comp_v2_default_post_color_balanced_denoised',
        'shadow_comp_v2_cfg_7_post_color_balanced_denoised',
        ],
        cropNames: ["AG8A6551-16ae8050c9_06_crop_B075X4QFK2", "9C4A8239-7a9d7093e2_04_crop_B082VLJ7Y2", "9C4A0566-a088c98ccf_05_crop_B07VKM698C", "9C4A3419-2e5c9b4d85_08_crop_B07B4D8B2S", "9C4A4878-4dac321d8b_02_crop_B07HP93VDJ", "9C4A4861-19626f89e9_04_crop_B07B4MSYPS", "AG8A0630-e5622e17d2_01_crop_B07B85FJD5", "AG8A6719-fc8e1ea686_05_crop_B07DBJ1H18", "AG8A3196-8e1dfd8d95_08_crop_B07WMQ8P8Q", "AG8A8843-b91f89fff2_05_crop_B07B4YXNR3"],
        methodsMapping: {
        'shadow_comp_v2_cfg_1_post_color_balanced_denoised': 'γ=1.0 (no guidance)',
        'shadow_comp_v2_default_post_color_balanced_denoised': 'γ=3.0 (default)',
        'shadow_comp_v2_cfg_7_post_color_balanced_denoised': 'γ=7.0',
        },
        folderName: 'figures/ext_cfg',
    });

    makeResultsTable2({
        resultsContainer: document.getElementById('results-container-latent-weight'),
        azimuthSlider: document.getElementById('latent-weight-azimuth-slider'),
        azimuthValueText: document.getElementById('latent-weight-azimuth-value'),
        parameterSlider: document.getElementById('latent-weight-slider'),
        parameterValueText: document.getElementById('latent-weight-value'),
        methods: [
        'shadow_comp_v2_latent_weight_0_post_color_balanced_denoised',
        'shadow_comp_v2_default_post_color_balanced_denoised',
        'shadow_comp_v2_latent_weight_0.2_post_color_balanced_denoised',
        ],
        cropNames: ["AG8A6551-16ae8050c9_06_crop_B075X4QFK2", "9C4A8239-7a9d7093e2_04_crop_B082VLJ7Y2", "9C4A0566-a088c98ccf_05_crop_B07VKM698C", "9C4A3419-2e5c9b4d85_08_crop_B07B4D8B2S", "9C4A4878-4dac321d8b_02_crop_B07HP93VDJ", "9C4A4861-19626f89e9_04_crop_B07B4MSYPS", "AG8A0630-e5622e17d2_01_crop_B07B85FJD5", "AG8A6719-fc8e1ea686_05_crop_B07DBJ1H18", "AG8A3196-8e1dfd8d95_08_crop_B07WMQ8P8Q", "AG8A8843-b91f89fff2_05_crop_B07B4YXNR3"],
        methodsMapping: {
        'shadow_comp_v2_latent_weight_0_post_color_balanced_denoised': 'β=0 (no shadow blending)',
        'shadow_comp_v2_default_post_color_balanced_denoised': 'β=0.05 (default)',
        'shadow_comp_v2_latent_weight_0.2_post_color_balanced_denoised': 'β=0.2',
        },
        folderName: 'figures/ext_latent_weight',
    });

    makeResultsTable2({
        resultsContainer: document.getElementById('results-container-light-size'),
        azimuthSlider: document.getElementById('light-size-azimuth-slider'),
        azimuthValueText: document.getElementById('light-size-azimuth-value'),
        parameterSlider: document.getElementById('light-size-slider'),
        parameterValueText: document.getElementById('light-size-value'),
        methods: [
        'shadow_comp_v2_light_radius_0_post_color_balanced_denoised',
        'shadow_comp_v2_default_post_color_balanced_denoised',
        'shadow_comp_v2_light_radius_5_post_color_balanced_denoised',
        ],
        cropNames: ["AG8A6551-16ae8050c9_06_crop_B075X4QFK2", "9C4A8239-7a9d7093e2_04_crop_B082VLJ7Y2", "9C4A0566-a088c98ccf_05_crop_B07VKM698C", "9C4A3419-2e5c9b4d85_08_crop_B07B4D8B2S", "9C4A4878-4dac321d8b_02_crop_B07HP93VDJ", "9C4A4861-19626f89e9_04_crop_B07B4MSYPS", "AG8A0630-e5622e17d2_01_crop_B07B85FJD5", "AG8A6719-fc8e1ea686_05_crop_B07DBJ1H18", "AG8A3196-8e1dfd8d95_08_crop_B07WMQ8P8Q", "AG8A8843-b91f89fff2_05_crop_B07B4YXNR3"],
        methodsMapping: {
        'shadow_comp_v2_light_radius_0_post_color_balanced_denoised': '0',
        'shadow_comp_v2_default_post_color_balanced_denoised': '1',
        'shadow_comp_v2_light_radius_5_post_color_balanced_denoised': '5',
        },
        folderName: 'figures/light_size',
    });
    
    makeResultsTable({
        resultsContainer: document.getElementById('results-container-two-lights'),
        methods: [
          'two_lights_shadow_comp_v2_default_post_color_balanced_static_denoised',
          'two_lights_shadow_comp_v2_default_post_color_balanced_denoised',
          'two_lights_shadow_comp_v2_default_full_composite',
        ],
        cropNames: ["AG8A0630-e5622e17d2_02_crop_B0717B4RRW", "AG8A8563-e652dd5751_02_crop_B07B78RCT5", "AG8A6551-16ae8050c9_06_crop_B075X4QFK2", "AG8A4106-248c9b6695_00_crop_B075X33SC6"],
        methodsMapping: {
          'two_lights_shadow_comp_v2_default_post_color_balanced_static_denoised': '$$x_{\\text{light 1}}$$',
          'two_lights_shadow_comp_v2_default_post_color_balanced_denoised': '$$x_{\\text{light 2}}$$',
          'two_lights_shadow_comp_v2_default_full_composite': '$$x_{\\text{combined}}$$',
        },
        folderName: 'figures/two_lights',
        cropSubfolder: false
    });

    makeResultsTable({
        resultsContainer: document.getElementById('results-container-bg-relight'),
        methods: [
          'shadow_comp_v2_default',
          'relight_shadow_comp_v2_default_default',
          'relight_shadow_comp_v2_default_avg',
          'relight_shadow_comp_v2_default_composed'
        ],
        cropNames: ["9C4A0132-07352d1dd0_01_crop_B07JVNBJTB", "AG8A6551-16ae8050c9_06_crop_B075X4QFK2", "9C4A6765-55315335bf_07_crop_B07DBDN79B", "9C4A2563-d4a99744c5_00_crop_B07DBGWFGY"],
        methodsMapping: {
          'shadow_comp_v2_default' : 'SpotLight',
          'relight_shadow_comp_v2_default_default' : 'Relit background',
          'relight_shadow_comp_v2_default_avg' : 'Average relit background',
          'relight_shadow_comp_v2_default_composed': 'Relit background + composition'
        },
        folderName: 'figures/bg_relight',
        cropSubfolder: false
    });
   // D:\Documents\Projets\maitrise-code\compositing-blender\outputs\c_o\jpg\relight_shadow_comp_v2_default_composed\AG8A6719-fc8e1ea686_05_crop_B072Y5MZQH\0005.jpg
   // D:\Documents\Projets\maitrise-code\compositing-blender\outputs\c_o\jpg\relight_shadow_comp_v2_default_composed\AG8A6551-16ae8050c9_06_crop_B075X4QFK2\0006.jpg
   // D:\Documents\Projets\maitrise-code\compositing-blender\outputs\c_o\jpg\relight_shadow_comp_v2_default_composed\AG8A4106-248c9b6695_00_crop_B075X33SC6\0003.jpg
   // D:\Documents\Projets\maitrise-code\compositing-blender\outputs\c_o\jpg\relight_shadow_comp_v2_default_composed\9C4A6765-55315335bf_07_crop_B07DBDN79B\gt_dir.jpg
   // D:\Documents\Projets\maitrise-code\compositing-blender\outputs\c_o\jpg\relight_shadow_comp_v2_default_composed\9C4A2563-d4a99744c5_00_crop_B07DBGWFGY\0000.jpg
   // D:\Documents\Projets\maitrise-code\compositing-blender\outputs\c_o\jpg\relight_shadow_comp_v2_default_composed\9C4A0566-a088c98ccf_00_crop_B07J2R9Y4W\gt_dir.jpg
  </script>
    <script src="./js/lightbox-plus-jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
  </body>
</html>
